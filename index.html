<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>Driver Management - Shipper</title>
	<meta name="theme-color" content="#FFFFFF" />
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="icon" href="assets/img/shipper-favicon.png" type="image/x-icon" />
	<link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
</head>
<body>
	<!-- Header -->
	<div class="header dflex align-center justify-between px-15">
		<img src="assets/img/shipperLogo.png" loading="lazy" alt="shipper logo">
		<div class="user-info dflex align-center p-15 text-med">
			Hello, <span class="text-primary">Shipper User</span> <i class="icon-user icon-small ml-15"></i>
		</div>
	</div>
	
	<div class="dflex">
		<!-- Left Menu Navigation -->
		<div class="left-menu">
			<a href="" class="text-med"><i class="icon"></i>Beranda</a>
			<a href="" class="text-med active"><i class="icon"></i>Driver Management</a>
			<a href="" class="text-med"><i class="icon"></i>Pickup</a>
		</div>
		
		<!-- Body Container -->
		<div class="body-container">
		
			<!-- Driver Management Container -->
			<div class="driver-management">
				<div class="driver-top dflex align-center justify-between">
					<div class="driver-top-left">
						<h2>DRIVER MANAGEMENT</h2>
						<span class="text-med">Data driver yang bekerja dengan Anda.</span>
					</div>
					<div class="driver-top-right dflex">
						<div class="input-with-icon">
							<i class="icon"></i>
							<input type="text" placeholder="Cari Driver" name="driver-name">
						</div>
						<button type="button" class="button button-with-icon ml-15">
							TAMBAH DRIVER <i class="icon-close"></i>
						</button>
					</div>
				</div>
			</div>
			
			<!--Render Driver List here-->
			<div id="driver-list">

			</div>
			
			<!--Pagination Button Here-->
			<div class="driver-list-pagination dflex" id="driver-list-pagination"></div>
		</div>
	</div>

	<!-- Load React. -->
	<script src="assets/react-dev-tools/babel.min.js"></script>
	<script src="assets/react-dev-tools/react-dev.js"></script>
	<script src="assets/react-dev-tools/react-dom-dev.js"></script>
	<!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script> -->
	<!-- Load React component. -->
	<!-- <script type="text/jsx" src="assets/js/driverList.js" crossorigin></script> -->
	<script type="text/jsx">
		const driverListElement = document.getElementById('driver-list');
		class GetData extends React.Component {
			constructor(props){
				super(props);
				this.state = {
					error:null,
					isLoaded:false,
					items:[],
					currentItems:[],
					currentPage: props.currentPage,
					itemPerRequest: props.itemPerRequest
				}
			}

			componentDidMount(){
				//fetch("https://randomuser.me/api/?page=1&results=5&nat=us")
				fetch("assets/json/randomuser.me.json")
				.then(res => res.json())
				.then(
					(result) => {
						this.setState({
							isLoaded:true,
							items:result.results
						}, function(){
							this.setPaginationData();
						});
					},
					(error) => {
						this.setState({
							isLoaded:true,
							error
						})
					}
				);
				this.props.onRef(this);
			}

			setPaginationData(){
				const loadTo = this.state.currentPage * this.state.itemPerRequest;
				const loadFrom = loadTo - this.state.itemPerRequest;
				console.log(loadFrom);
				console.log(loadTo);
				var tempItem = [];
				for(var i = loadFrom; i < loadTo;i++){
					tempItem.push(this.state.items[i]);
				}
				this.setState({
					currentItems:tempItem
				});
			}

			createCardTopSection(item){
				return (
					<div className="driver-card-top p-15 dflex justify-between align-center">
						<div className="dct-left">
							<span className="text-dim">Driver ID</span>
							<span className="text-primary"> {item.login.username}</span>
						</div>
						<div className="dct-right">
							<button type="button">
								<span className="rotate-90">&#8285;</span>
							</button>
						</div>
					</div>
				)
			}
			createCardBodySection(item){
				return(
					<div className="driver-body p-15" key={item.login.salt}>
						<img src={item.picture.thumbnail} loading="lazy" className="img-user"/>
						<div className="driver-attribute">
							<label>Nama Driver</label>
							<p>{item.name.first} {item.name.last}</p>
						</div>
						<div className="driver-attribute">
							<label>Telepon</label>
							<p>{item.cell}</p>
						</div>
						<div className="driver-attribute">
							<label>Email</label>
							<p>{item.email}</p>
						</div>
						<div className="driver-attribute">
							<label>Tanggal Lahir</label>
							<p>{this.formatDate(item.dob.date)}</p>
						</div>
					</div>
				)
			}
			formatDate(dateString){
				return (new Date(dateString).toJSON().slice(0,10).split('-').reverse().join('-'))
			}

			changeProps(currentPage, itemPerRequest){
				this.setState({
					currentPage:currentPage,
					itemPerRequest:itemPerRequest
				}, function () {
					this.setPaginationData();
				});
			}

			render(){
				const {error,isLoaded,currentItems} = this.state;
				if(error){
					return <div className="text-center">Error: {error.message}</div>;
				} else if(!isLoaded){
					return (
						<div className="dflex driver-list-container">
							<div className="text-center">Loading...</div>
						</div>
					)
				} else {
					return (
						<div className="dflex driver-list-container">
						{ 
							currentItems.map(item => (
								<div className="driver-col p-15" key={item.login.username}>
									<div className="driver-card bg-white">
										{this.createCardTopSection(item)}
										{this.createCardBodySection(item)}
									</div>
								</div>
							)) 
						}
						</div>
					)
				}
			}
		}

		class EnhancedChild extends React.Component {
			render() {
		    	return <GetData {...this.props} />
		  	}
		}


		class ManagePagination extends React.Component {
			constructor(props){
				super(props);
				this.state = {
					maxLoad:30,
					itemPerRequest:5,
					currentPage:1,
					isFirst:true,
					isLast:false,
				}
			}

			getAjaxData(type){
				if(type == 'prev'){
					this.setState({currentPage: this.state.currentPage - 1}, function () {
					    this.checkPagination();
					});
				} else if (type == 'next'){
					this.setState({currentPage: this.state.currentPage + 1}, function () {
					    this.checkPagination();
					});
				}
			}

			checkPagination(){
				if(this.state.currentPage == 1){
					this.setState({
						isFirst: true,
						isLast:false
					});
				}
				else if(this.state.currentPage == Math.ceil(this.state.maxLoad / this.state.itemPerRequest)){
					this.setState({
						isFirst:false,
						isLast:true
					});
				} else {
					this.setState({
						isFirst:false,
						isLast:false
					});
				}
				this.getData.changeProps(this.state.currentPage,this.state.itemPerRequest);
			}

			render(){
				return (
					<div>
						{/*<GetData currentPage={this.state.currentPage} itemPerRequest={this.state.itemPerRequest} />*/}
						<EnhancedChild currentPage={this.state.currentPage} itemPerRequest={this.state.itemPerRequest} onRef={ref => (this.getData = ref)}/>
						<div className="driver-list-pagination dflex" id="driver-list-pagination">
							<a className={this.state.isFirst?'paginate-button disabled':'paginate-button'} onClick={() => this.getAjaxData('prev')}>
								<span className="mr-7">&#10094;</span> 
								Previous Page
							</a>
							<a className={this.state.isLast?'paginate-button disabled':'paginate-button'} onClick={() => this.getAjaxData('next')}>
								Next Page 
								<span className="ml-7">&#10095;</span>
							</a>
						</div>
					</div>
				)
			}
		}
		ReactDOM.render(
		   <ManagePagination />, driverListElement
	 	);

	 	class SearchDriver extends React.Component {

	 	}
	</script>
</body>
</html>